import{useState as e,useRef as t,useCallback as r,useEffect as n,cache as o}from"react";import{print as i}from"graphql/language/printer.js";import{traverse as s}from"object-traversal";import a from"is-integer";function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}function c(o){void 0===o&&(o=0);var i="undefined"==typeof window,s=e({isScrolling:!1,isPageTop:!1,isPageBottom:!1,isScrolledUp:!0,isScrolledDown:!1,scrolledPosition:i?0:window.pageYOffset,documentHeight:i?0:document.documentElement.offsetHeight,viewportHeight:i?0:window.innerHeight,timer:null}),a=s[0],c=s[1],l=t(a),f=r(function(){l.current.timer&&clearTimeout(l.current.timer);var e=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),t=i?0:window.innerHeight,r=i?0:Math.max(0,Math.ceil(window.pageYOffset)),n=!i&&window.innerHeight+r>=e-o,s={isScrolling:!0,isPageTop:!!i||window.pageYOffset<=0,isPageBottom:n,isScrolledUp:r<l.current.scrolledPosition,isScrolledDown:r>l.current.scrolledPosition,scrolledPosition:r,documentHeight:e,viewportHeight:t,timer:l.current.timer};c(s),l.current=u({},s,{timer:setTimeout(function(){return c(u({},s,{isScrolling:!1}))},100)})},[i,o]);return n(function(){return f(),window.addEventListener("scroll",f),function(){window.removeEventListener("scroll",f)}},[f]),a}function l(e){var t={exports:{}};return e(t,t.exports),t.exports}var f=l(function(e){var t,r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};function a(e){var t;const r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean);return`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}; ${r.join("; ")}`}function u(e){const t=/* @__PURE__ */new Map;for(const r of e.split(/; */)){if(!r)continue;const e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}const[n,o]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=o?o:"true"))}catch{}}return t}function c(e){if(!e)return;const[[t,r],...n]=u(e),{domain:o,expires:i,httponly:s,maxage:a,path:c,samesite:f,secure:p,priority:h}=Object.fromEntries(n.map(([e,t])=>[e.toLowerCase(),t]));return function(e){const t={};for(const r in e)e[r]&&(t[r]=e[r]);return t}({name:t,value:decodeURIComponent(r),domain:o,...i&&{expires:new Date(i)},...s&&{httpOnly:!0},..."string"==typeof a&&{maxAge:Number(a)},path:c,...f&&{sameSite:(v=f,v=v.toLowerCase(),l.includes(v)?v:void 0)},...p&&{secure:!0},...h&&{priority:d(h)}});var v}((e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})})(s,{RequestCookies:()=>p,ResponseCookies:()=>h,parseCookie:()=>u,parseSetCookie:()=>c,stringifyCookie:()=>a}),e.exports=(t=s,((e,t,s,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of o(t))i.call(e,s)||void 0===s||r(e,s,{get:()=>t[s],enumerable:!(a=n(t,s))||a.enumerable});return e})(r({},"__esModule",{value:!0}),t));var l=["strict","lax","none"],f=["low","medium","high"];function d(e){return e=e.toLowerCase(),f.includes(e)?e:void 0}var p=class{constructor(e){this._parsed=/* @__PURE__ */new Map,this._headers=e;const t=e.get("cookie");if(t){const e=u(t);for(const[t,r]of e)this._parsed.set(t,{name:t,value:r})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){return this._parsed.get("string"==typeof e[0]?e[0]:e[0].name)}getAll(...e){var t;const r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);const n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){const[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>a(t)).join("; ")),this}delete(e){const t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>a(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},h=class{constructor(e){var t,r,n;this._parsed=/* @__PURE__ */new Map,this._headers=e;const o=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[],i=Array.isArray(o)?o:function(e){if(!e)return[];var t,r,n,o,i,s=[],a=0;function u(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}for(;a<e.length;){for(t=a,i=!1;u();)if(","===(r=e.charAt(a))){for(n=a,a+=1,u(),o=a;a<e.length&&"="!==(r=e.charAt(a))&&";"!==r&&","!==r;)a+=1;a<e.length&&"="===e.charAt(a)?(i=!0,a=o,s.push(e.substring(t,n)),t=a):a=n+1}else a+=1;(!i||a>=e.length)&&s.push(e.substring(t,e.length))}return s}(o);for(const e of i){const t=c(e);t&&this._parsed.set(t.name,t)}}get(...e){return this._parsed.get("string"==typeof e[0]?e[0]:e[0].name)}getAll(...e){var t;const r=Array.from(this._parsed.values());if(!e.length)return r;const n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){const[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,o=this._parsed;return o.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),null==e.path&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){t.delete("set-cookie");for(const[,r]of e){const e=a(r);t.append("set-cookie",e)}}(o,this._headers),this}delete(...e){const[t,r,n]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:n,value:"",expires:/* @__PURE__ */new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a).join("; ")}}}),d=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return f.RequestCookies},ResponseCookies:function(){return f.ResponseCookies}})}),p=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){const n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}}),h=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyRequestCookiesError:function(){return r},RequestCookiesAdapter:function(){return n},getModifiedCookieValues:function(){return i},appendMutableCookies:function(){return s},MutableRequestCookiesAdapter:function(){return a}});class r extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new r}}class n{static seal(e){return new Proxy(e,{get(e,t,n){switch(t){case"clear":case"delete":case"set":return r.callable;default:return p.ReflectAdapter.get(e,t,n)}}})}}const o=Symbol.for("next.mutated.cookies");function i(e){const t=e[o];return t&&Array.isArray(t)&&0!==t.length?t:[]}function s(e,t){const r=i(t);if(0===r.length)return!1;const n=new d.ResponseCookies(e),o=n.getAll();for(const e of r)n.set(e);for(const e of o)n.set(e);return!0}class a{static wrap(e,t){const r=new d.ResponseCookies(new Headers);for(const t of e.getAll())r.set(t);let n=[];const i=new Set,s=()=>{var e;const o=null==fetch.__nextGetStaticStore||null==(e=fetch.__nextGetStaticStore.call(fetch))?void 0:e.getStore();o&&(o.pathWasRevalidated=!0);const s=r.getAll();if(n=s.filter(e=>i.has(e.name)),t){const e=[];for(const t of n){const r=new d.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case o:return n;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{s()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{s()}};default:return p.ReflectAdapter.get(e,t,r)}}})}}}),v=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyHeadersError:function(){return r},HeadersAdapter:function(){return n}});class r extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new r}}class n extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,n){if("symbol"==typeof r)return p.ReflectAdapter.get(t,r,n);const o=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===o);return void 0!==i?p.ReflectAdapter.get(t,i,n):void 0},set(t,r,n,o){if("symbol"==typeof r)return p.ReflectAdapter.set(t,r,n,o);const i=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return p.ReflectAdapter.set(t,s??r,n,o)},has(t,r){if("symbol"==typeof r)return p.ReflectAdapter.has(t,r);const n=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0!==o&&p.ReflectAdapter.has(t,o)},deleteProperty(t,r){if("symbol"==typeof r)return p.ReflectAdapter.deleteProperty(t,r);const n=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0===o||p.ReflectAdapter.deleteProperty(t,o)}})}static seal(e){return new Proxy(e,{get(e,t,n){switch(t){case"append":case"delete":case"set":return r.callable;default:return p.ReflectAdapter.get(e,t,n)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new n(e)}append(e,t){const r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){const t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(const[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(const e of Object.keys(this.headers)){const t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(const e of Object.keys(this.headers)){const t=e.toLowerCase();yield t}}*values(){for(const e of Object.keys(this.headers)){const t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}}),g=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAsyncLocalStorage",{enumerable:!0,get:function(){return i}});const r=new Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available");class n{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}}const o=globalThis.AsyncLocalStorage;function i(){return o?new o:new n}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),y=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"requestAsyncStorage",{enumerable:!0,get:function(){return r}});const r=(0,g.createAsyncLocalStorage)();("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),m=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"actionAsyncStorage",{enumerable:!0,get:function(){return r}});const r=(0,g.createAsyncLocalStorage)();("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),b=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{DYNAMIC_ERROR_CODE:function(){return r},DynamicServerError:function(){return n}});const r="DYNAMIC_SERVER_USAGE";class n extends Error{constructor(e){super("Dynamic server usage: "+e),this.digest=r}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),_=l(function(e,t){function r(e,t){if(e.isStaticGeneration&&e.experimental.ppr){if(!e.postpone)throw new Error("Invariant: PPR is enabled but the postpone API is unavailable");e.postponeWasTriggered=!0,e.postpone("This page needs to bail out of prerendering at this point because it used "+t+". React throws this special object to indicate where. It should not be caught by your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error")}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"maybePostpone",{enumerable:!0,get:function(){return r}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),w=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"staticGenerationAsyncStorage",{enumerable:!0,get:function(){return r}});const r=(0,g.createAsyncLocalStorage)();("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),O=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"staticGenerationBailout",{enumerable:!0,get:function(){return o}});class r extends Error{constructor(...e){super(...e),this.code="NEXT_STATIC_GEN_BAILOUT"}}function n(e,t){const{dynamic:r,link:n}=t||{};return"Page"+(r?' with `dynamic = "'+r+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(n?" See more info here: "+n:"")}const o=(e,t)=>{const o=w.staticGenerationAsyncStorage.getStore();if(!o)return!1;if(o.forceStatic)return!0;var i;if(o.dynamicShouldError)throw new r(n(e,{...t,dynamic:null!=(i=null==t?void 0:t.dynamic)?i:"error"}));const s=n(e,{...t,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if((0,_.maybePostpone)(o,e),o.revalidate=0,(null==t?void 0:t.dynamic)||(o.staticPrefetchBailout=!0),o.isStaticGeneration){const t=new b.DynamicServerError(s);throw o.dynamicUsageDescription=e,o.dynamicUsageStack=t.stack,t}return!1};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),A=l(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return r}});class r{get isEnabled(){return this._provider.isEnabled}enable(){if(!(0,O.staticGenerationBailout)("draftMode().enable()"))return this._provider.enable()}disable(){if(!(0,O.staticGenerationBailout)("draftMode().disable()"))return this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),j=l(function(e,t){function r(){if((0,O.staticGenerationBailout)("headers",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return v.HeadersAdapter.seal(new Headers({}));const e=y.requestAsyncStorage.getStore();if(!e)throw new Error("Invariant: headers() expects to have requestAsyncStorage, none available.");return e.headers}function n(){if((0,O.staticGenerationBailout)("cookies",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return h.RequestCookiesAdapter.seal(new d.RequestCookies(new Headers({})));const e=y.requestAsyncStorage.getStore();if(!e)throw new Error("Invariant: cookies() expects to have requestAsyncStorage, none available.");const t=m.actionAsyncStorage.getStore();return t&&(t.isAction||t.isAppRoute)?e.mutableCookies:e.cookies}function o(){const e=y.requestAsyncStorage.getStore();if(!e)throw new Error("Invariant: draftMode() expects to have requestAsyncStorage, none available.");return new A.DraftMode(e.draftMode)}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{headers:function(){return r},cookies:function(){return n},draftMode:function(){return o}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}),S=j;function P(e,t,r){if(!e.s){if(r instanceof x){if(!r.s)return void(r.o=P.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(P.bind(null,e,t),P.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var E=function(e,t){try{var r,n,o,s,a=function(t){function r(t){return c.logs&&console.log("[api-query]","calling",l),Promise.resolve(R(u({},f,{tags:n}))).then(function(r){var n;function i(e){return n?e:u({},s,{draftUrl:null!=(o=t.url)?o:null})}s=r.data;var a=function(){var r;if(c.all)return Promise.resolve(C(e,c,s,l)).then(function(e){var o=u({},e,{draftUrl:null!=(r=t.url)?r:null});return n=1,o})}();return a&&a.then?a.then(i):i(a)})}var n=d?T(t,c.tags,c.maxTags):t;return c.includeDrafts?Promise.resolve(R(u({},f,{tags:n,url:"https://graphql-listen.datocms.com/preview"}))).then(r):r({})},c=u({},k,null!=t?t:{});if(c.generateTags=!process.env.NEXT_DATO_UTILS_DISABLE_TAGS&&c.generateTags,c.logs=!!process.env.NEXT_DATO_UTILS_ENABLE_LOGS||c.logs,!process.env.DATOCMS_API_TOKEN&&!process.env.NEXT_PUBLIC_DATOCMS_API_TOKEN)throw new Error("DATOCMS_API_TOKEN is not set");if(!process.env.DATOCMS_ENVIRONMENT&&!process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT)throw new Error("DATOCMS_ENVIRONMENT is not set");var l=null==(r=(null==(n=e.definitions)?void 0:n[0]).name)?void 0:r.value;if(void 0===(null==t?void 0:t.includeDrafts))try{c.includeDrafts=S.draftMode().isEnabled}catch(e){}var f=u({body:JSON.stringify({query:i(e),variables:null==t?void 0:t.variables})},c,{queryId:l}),d=c.generateTags;return Promise.resolve(d?Promise.resolve(R(f)).then(a):a(c.tags))}catch(e){return Promise.reject(e)}},x=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{P(n,1,i(this.v))}catch(e){P(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?P(n,1,t?t(o):o):r?P(n,1,r(o)):P(n,2,o)}catch(e){P(n,2,e)}},n},e}();function M(e){return e instanceof x&&1&e.s}var k={variables:void 0,includeDrafts:!1,excludeInvalid:!0,visualEditingBaseUrl:void 0,revalidate:a(process.env.REVALIDATE_TIME)?parseInt(process.env.REVALIDATE_TIME):3600,tags:void 0,generateTags:!0,maxTags:100,logs:!1,all:!1},C=function(e,t,r,n){try{return Promise.resolve(function(n,o){try{var i=function(){var n,o,i,s,a,c,l;if("object"!=typeof r||null==r)throw new Error("Data must be an object");var f=null==(n=e.definitions)?void 0:n.find(function(e){return"OperationDefinition"===e.kind});if(!f)throw new Error("Query must have an operation definition");var d=null==(o=f.variableDefinitions)?void 0:o.find(function(e){return"first"===e.variable.name.value}),p=null==(i=f.variableDefinitions)?void 0:i.find(function(e){return"skip"===e.variable.name.value});if(!d||!p)throw new Error("Query must have first and skip variables");var h=Object.keys(r).filter(function(e){return e.startsWith("_all")&&e.endsWith("Meta")});if(0===h.length)throw new Error("Query must have at least one paginated field");var v=h.reduce(function(e,t){return e[t]=""+t.substring(1,t.length-4),e},{});Object.keys(v).forEach(function(e){var t,r,n=null==(t=f.selectionSet.selections.find(function(t){return t.name.value===e}))||null==(t=t.arguments)?void 0:t.find(function(e){return"filter"===e.name.value}),o=null==(r=f.selectionSet.selections.find(function(t){return t.name.value===v[e]}))||null==(r=r.arguments)?void 0:r.find(function(e){return"filter"===e.name.value});if(!n&&o||n&&!o||JSON.stringify(n)!==JSON.stringify(o))throw new Error("Query must have same filter argument on "+e+" and "+v[e])});var g=null!=(s=null!=(a=null==(c=t.variables)?void 0:c.first)?a:null==d||null==(l=d.defaultValue)?void 0:l.value)?s:100;if(g>100)throw new Error('"first" variable must be less than or equal to 100');var y=0,m=function(e,t,r){for(var n;;){var o=e();if(M(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=r();if(i&&i.then){if(!M(i)){n=1;break}i=i.s}if(t){var s=t();if(s&&s.then&&!M(s)){n=2;break}}}var a=new x,u=P.bind(null,a,2);return(0===n?o.then(l):1===n?i.then(c):s.then(f)).then(void 0,u),a;function c(n){i=n;do{if(t&&(s=t())&&s.then&&!M(s))return void s.then(f).then(void 0,u);if(!(o=e())||M(o)&&!o.v)return void P(a,1,i);if(o.then)return void o.then(l).then(void 0,u);M(i=r())&&(i=i.v)}while(!i||!i.then);i.then(c).then(void 0,u)}function l(e){e?(i=r())&&i.then?i.then(c).then(void 0,u):c(i):P(a,1,i)}function f(){(o=e())?o.then?o.then(l).then(void 0,u):l(o):P(a,1,i)}}(function(){return!!Object.keys(v).some(function(e){return r[e].count>r[v[e]].length})},void 0,function(){var n=v[Object.keys(v).sort(function(e,t){return r[e].count>r[t].count?-1:1})[0]];return Promise.resolve(E(e,u({},t,{all:!1,variables:u({},t.variables,{first:g,skip:r[n].length})}))).then(function(e){if(Object.keys(v).forEach(function(t){return r[v[t]]=[].concat(r[v[t]],e[v[t]])}),++y>1e3)throw new Error("Paginated query exceeded 1000 requests")})});return m&&m.then?m.then(function(e){return r}):r}()}catch(e){return o(e)}return i&&i.then?i.then(void 0,o):i}(0,function(e){throw new Error(n+": "+e.message)}))}catch(e){return Promise.reject(e)}},R=o(function(e){try{var t,r,n=e.url,o=e.body,i=e.visualEditingBaseUrl,s=e.revalidate,a=e.tags,c=e.queryId,l=e.logs,f=u({Authorization:"Bearer "+(null!=(t=process.env.DATOCMS_API_TOKEN)?t:process.env.NEXT_PUBLIC_DATOCMS_API_TOKEN)},e.includeDrafts?{"X-Include-Drafts":"true"}:{},e.excludeInvalid?{"X-Exclude-Invalid":"true"}:{},i?{"X-Visual-Editing":"vercel-v1","X-Base-Editing-Url":i}:{},process.env.DATOCMS_ENVIRONMENT?{"X-Environment":null!=(r=process.env.DATOCMS_ENVIRONMENT)?r:process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT}:{});return Promise.resolve(fetch(null!=n?n:"https://graphql.datocms.com/",{method:"POST",headers:f,body:o,next:{revalidate:s,tags:Array.isArray(a)?a:void 0}})).then(function(t){return Promise.resolve(t.json()).then(function(r){var n;if(!t.ok)throw new Error(t.status+" "+t.statusText+": "+JSON.stringify(r));if(r.errors)throw new Error(c+": "+r.errors.map(function(e){return e.message}).join(". "));return l&&console.log("[api-query]",c,u({},e,{body:void 0}),"tags: "+(null!=(n=null==a?void 0:a.length)?n:0),t.headers.get("x-cache")),r})})}catch(e){return Promise.reject(e)}}),T=function(e,t,r){var n=null!=t&&t.length?t:[];return s(e,function(e){return"id"===e.key&&n.push(String(e.value))}),n.filter(function(e,t,r){return r.indexOf(e)===t}).filter(function(e){return e}).slice(0,r)},D=function(t,o){var i,s,a,c=void 0===o?{}:o,l=c.variables,f=c.initialData,d=c.pageSize,p=void 0===d?100:d,h=c.includeDrafts,v=void 0!==h&&h,g=e(f),y=g[0],m=g[1],b=e(f),_=b[0],w=b[1],O=e(p?{no:1,count:(null==(i=f.pagination)?void 0:i.count)||0,size:p,end:(null==(s=f.pagination)?void 0:s.count)>0&&(null==(a=f.pagination)?void 0:a.count)<=p}:void 0),A=O[0],j=O[1],S=e(),P=S[0],x=S[1],M=e(!1),k=M[0],C=M[1];n(function(){JSON.stringify(f)!==JSON.stringify(y)&&(w(f),m(f))},[f]);var R=r(function(e){return C(!0),E(t,{variables:u({},l,e),includeDrafts:v}).then(function(e){var t=D(e,_);return w(t),t}).finally(function(){return C(!1)})},[t,l,_]),T=r(function(){try{if(!A)return Promise.resolve(x(new Error("No page size set!")));var e=A.size,t=A.no*A.size;return Promise.resolve(t>A.count&&A.count>0?A:function(r,n){try{var o=Promise.resolve(R(u({},l.variables,{first:e,skip:t}))).then(function(e){var t,r=Object.keys(e).find(function(t){return"number"==typeof e[t].count});if(!r)throw new Error("No count found in response");var n=(null==(t=e[r])?void 0:t.count)||0,o=A.no+1,i=u({},A,{no:o,count:n,end:o*p>=n});return j(i),i})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){return x(e),A}))}catch(e){return Promise.reject(e)}},[A,l,p,j,x,R]),D=function(e,t){return t&&e?(Object.keys(e).forEach(function(r){t[r]&&Array.isArray(t[r])&&(e[r]=t[r].concat(e[r]))}),e):e};return n(function(){!f&&R()},[f,R]),{data:_,error:P,loading:k,loadMore:function(e){return R(e)},nextPage:T,page:A}};export{D as useApiQuery,c as useScrollInfo};
//# sourceMappingURL=index.modern.mjs.map
